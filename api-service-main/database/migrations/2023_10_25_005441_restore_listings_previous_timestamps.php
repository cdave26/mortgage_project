<?php

use App\Enums\Environment;
use App\Models\Listing;
use Carbon\Carbon;
use Illuminate\Database\Migrations\Migration;
use Illuminate\Support\Facades\App;

return new class extends Migration
{
    public array $timestamps = [
        25 => '2023-10-17 17:00:10',
        26 => '2023-10-17 16:59:37',
        27 => '2023-10-17 17:00:42',
        28 => '2023-10-17 17:01:24',
        29 => '2023-10-17 17:02:00',
        35 => '2023-10-17 16:20:50',
        39 => '2023-10-17 16:18:49',
        40 => '2023-10-17 17:02:54',
        118 => '2023-10-13 15:52:36',
        119 => '2023-10-13 15:51:48',
        123 => '2023-10-13 15:53:12',
        132 => '2023-10-19 11:40:39',
        246 => '2023-10-13 09:06:04',
        370 => '2023-10-14 17:27:37',
        377 => '2023-10-18 20:10:36',
        392 => '2023-10-18 20:01:45',
        393 => '2023-10-19 02:11:28',
        402 => '2023-10-19 02:05:22',
        403 => '2023-10-19 02:01:02',
        404 => '2023-10-18 20:06:15',
        439 => '2023-10-18 20:07:51',
        440 => '2023-10-18 20:08:08',
        441 => '2023-10-18 20:08:33',
        442 => '2023-10-18 20:08:58',
        443 => '2023-10-18 20:09:11',
        444 => '2023-10-18 20:09:40',
        557 => '2023-10-12 16:42:10',
        579 => '2023-10-13 10:05:44',
        580 => '2023-10-13 10:05:20',
        582 => '2023-10-13 10:05:27',
        603 => '2023-10-14 01:52:00',
        605 => '2023-10-13 15:46:40',
        606 => '2023-10-18 16:32:02',
        610 => '2023-10-18 16:27:25',
        621 => '2023-10-17 00:35:54',
        624 => '2023-10-16 00:54:32',
        625 => '2023-10-20 08:05:09',
        630 => '2023-10-20 04:38:26',
        646 => '2023-10-20 10:58:42',
        647 => '2023-10-20 11:25:40',
        651 => '2023-10-20 20:36:13',
        652 => '2023-10-21 08:53:09',
    ];

    /**
     * Run the migrations.
     */
    public function up(): void
    {
        if (!App::environment(Environment::PRODUCTION) || !Carbon::today()
            ->isSameDay('2023-10-24')) {
            return;
        }

        $listings = Listing::where('id', '<', 658)
            ->get();

        $listings->map(function (Listing $listing) {
            if (array_key_exists($listing->id, $this->timestamps)) {
                $listing->updated_at = $this->timestamps[$listing->id];
            } else {
                $listing->updated_at = $listing->created_at;
            }
            $listing->saveQuietly();
        });
    }
};
